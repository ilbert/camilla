<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Men√∫ - Camillas</title>
  <style>
    :root{
      --brand:#034ca8; --brand2:#0b5bd3;
      --border:#e6e8eb; --bg:#f4f6f9;
      --shadow:0 24px 60px rgba(0,0,0,.18);
    }

    *{box-sizing:border-box}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:var(--bg); overflow:hidden; color:#0f172a; -webkit-text-size-adjust:100%;
    }

    header{
      background:#fff; height:60px; display:flex; align-items:center;
      padding:0 16px; border-bottom:1px solid var(--border)
    }

    .hamburger{
      width:44px; height:44px; border:1px solid var(--border); background:#fff;
      cursor:pointer; border-radius:12px; font-size:20px; color:var(--brand)
    }

    #overlay{position:fixed; inset:0; background:rgba(0,0,0,.45); display:none; z-index:1000}
    #drawer{
      position:fixed; inset:0 auto 0 0; background:#fff; z-index:1001; display:none;
      flex-direction:column; box-shadow:10px 0 30px rgba(0,0,0,.12); width:auto; max-width:96vw
    }
    .drawer-header{
      padding:14px 16px; border-bottom:1px solid var(--border);
      display:flex; justify-content:space-between; align-items:center; font-weight:900; color:var(--brand)
    }
    .close-x{border:none; background:none; cursor:pointer; font-size:18px; line-height:1}

    #status{padding:10px; text-align:center; font-size:12px; background:#fff3cd; display:none}

    #columns-container{
      display:flex; flex:1; overflow-x:auto; overflow-y:hidden; background:#fff;
      scrollbar-width:none; -ms-overflow-style:none; -webkit-overflow-scrolling:touch;
    }

    .column{flex:0 0 330px; border-right:1px solid #eee; overflow-y:auto; height:100%}
    @media (max-width:520px){ .column{flex-basis:86vw} }

    ul{list-style:none; padding:0; margin:0}
    .item{
      padding:14px 16px; display:flex; justify-content:space-between; align-items:center; gap:10px;
      cursor:pointer; font-size:14px; border-bottom:1px solid #f3f4f6;
      transition:background .12s ease, color .12s ease; -webkit-tap-highlight-color:transparent;
    }
    .item:hover{background:#f7f9fc; color:var(--brand)}

    .item.active{
      background:#e6f2fa; color:var(--brand); font-weight:900; border-left:5px solid var(--brand)
    }

    .label{display:flex; align-items:center; gap:10px; min-width:0}
    .text{overflow:hidden; text-overflow:ellipsis; white-space:nowrap}
    .icon{width:22px; height:22px; display:inline-grid; place-items:center; font-size:18px; flex:0 0 auto}
    .chevron{width:22px; height:22px; display:inline-flex; align-items:center; justify-content:center; flex:0 0 auto}
    .chevron svg{width:18px; height:18px; stroke:var(--brand); stroke-width:2.6; fill:none; stroke-linecap:round; stroke-linejoin:round}
    .column-header{
      padding:14px 14px 8px; font-weight:900; color:var(--brand); font-size:18px;
      display:flex; align-items:center; gap:10px
    }
    .back-only{border:none; background:transparent; padding:0; cursor:pointer; display:inline-flex; align-items:center}
  </style>
</head>
<body>

<header>
  <button class="hamburger" id="openBtn">‚ò∞</button>
  <div style="margin-left:12px;font-weight:1000;color:var(--brand);letter-spacing:.2px;">
    MEN√ö CAMILLAS
  </div>
</header>

<div id="overlay"></div>

<aside id="drawer">
  <div class="drawer-header">
    <span>CAMILLAS</span>
    <button class="close-x" id="closeBtn">‚úï</button>
  </div>
  <div id="status"></div>
  <div id="columns-container"></div>
</aside>

<script>
  // ====== Sheet de rutas camillas ======
  const RUTAS_SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSgtiuyp4R8x5MFy_pqpd0i2fJiyg1YPvONiLKi-mHGeoUu87w3ToCLu0OZMIDAlqfUnok6iJvRHvNt/pub?output=csv&gid=0";

  const CHEVRON_SVG = `<span class="chevron"><svg viewBox="0 0 24 24"><path d="M9 6l6 6-6 6"/></svg></span>`;
  const BACK_CHEVRON_SVG = `<span class="chevron" style="transform:rotate(180deg)"><svg viewBox="0 0 24 24"><path d="M9 6l6 6-6 6"/></svg></span>`;

  const ICON_MAP = {
    "camillas":"üõèÔ∏è",
    "camillas electricas":"üõèÔ∏è",
    "camillas manuales":"üõèÔ∏è",
    "camillas de exploracion":"üõèÔ∏è",
    "camillas hidraulicas":"üõèÔ∏è",
    "camillas de masaje":"üõèÔ∏è"
  };

  let menuTree = [];

  const drawer = document.getElementById("drawer");
  const overlay = document.getElementById("overlay");
  const statusEl = document.getElementById("status");

  const norm = (s) => String(s||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim();
  const displayName = (name) => String(name||"").replace(/\s+Total\s*$/i,"").trim();

  function parseCSV(text){
    const rows = []; let cur = "", row = [], inQ = false;
    for (let i = 0; i < text.length; i++) {
      const ch = text[i];
      if (ch === '"') inQ = !inQ;
      else if (ch === ',' && !inQ) { row.push(cur); cur = ""; }
      else if ((ch === '\n' || ch === '\r') && !inQ) {
        row.push(cur); cur = "";
        if (row.join("").trim()) rows.push(row);
        row = [];
      } else cur += ch;
    }
    row.push(cur); if (row.join("").trim()) rows.push(row);
    return rows;
  }

  function buildTree(csv){
    const root = [];
    const rows = parseCSV(csv);
    const skipHeaders = ["ruta", "ruta camillas", "camilla", "categoria", "categor√≠a"];
    rows.forEach((row, idx) => {
      const cell = (row[0] || "").trim().replace(/^["']|["']$/g, "");
      if (!cell) return;
      const parts = cell.split(">").map(p => p.trim()).filter(Boolean);
      if (parts.length === 1 && skipHeaders.includes(norm(parts[0]))) return;
      let current = root;
      parts.forEach((rawName) => {
        const name = displayName(rawName);
        let node = current.find(n => n.name === name);
        if (!node) { node = { name, children: [] }; current.push(node); }
        current = node.children;
      });
    });
    menuTree = root;
  }

  function handleItemClick(item, level, liElement, container, col){
    const wasActive = liElement.classList.contains("active");
    const ul = liElement.parentNode;
    Array.from(ul.children).forEach(l => l.classList.remove("active"));

    if(item.children.length && wasActive) {
      const myColIndex = Array.from(container.children).indexOf(col);
      Array.from(container.querySelectorAll(".column")).slice(myColIndex + 1).forEach(c => c.remove());
      liElement.classList.remove("active");
    } else {
      liElement.classList.add("active");
      if(item.children.length) render(item.children, level + 1, item);
    }
  }

  function renderRootMenu(){
    const container = document.getElementById("columns-container");
    container.innerHTML = "";
    const col = document.createElement("div");
    col.className = "column";

    const ul = document.createElement("ul");
    menuTree.forEach(item => {
      const li = document.createElement("li");
      li.className = "item";
      const icon = ICON_MAP[norm(item.name)] || "üõèÔ∏è";
      li.innerHTML = `<span class="label"><span class="icon">${icon}</span><span class="text">${item.name}</span></span>${item.children.length ? CHEVRON_SVG : ''}`;
      li.onclick = () => handleItemClick(item, 0, li, container, col);
      ul.appendChild(li);
    });

    col.appendChild(ul);
    container.appendChild(col);
  }

  function render(items, level, parent=null){
    const container = document.getElementById("columns-container");
    if(level === 0) container.innerHTML = "";
    else Array.from(container.querySelectorAll(".column")).slice(level).forEach(c => c.remove());

    const col = document.createElement("div");
    col.className = "column";
    const headerText = level === 0 ? `<button class="back-only" onclick="renderRootMenu()">${BACK_CHEVRON_SVG}</button> Inicio` : parent.name;
    col.innerHTML = `<div class="column-header">${headerText}</div><ul></ul>`;
    const ul = col.querySelector("ul");

    items.forEach(item => {
      const li = document.createElement("li");
      li.className = "item";
      const icon = ICON_MAP[norm(item.name)] || "üõèÔ∏è";
      li.innerHTML = `<span class="label"><span class="icon">${icon}</span><span class="text">${item.name}</span></span>${item.children.length ? CHEVRON_SVG : ''}`;
      li.onclick = () => handleItemClick(item, level, li, container, col);
      ul.appendChild(li);
    });

    container.appendChild(col);
  }

  async function loadData(){
    statusEl.style.display = "block";
    statusEl.textContent = "Cargando rutas...";
    try {
      const res = await fetch(RUTAS_SHEET_URL + "&_=" + Date.now());
      const csv = await res.text();
      buildTree(csv);
      statusEl.style.display = "none";
      renderRootMenu();
    } catch(e) {
      statusEl.textContent = "Error al cargar. Comprueba que el sheet est√© publicado.";
      statusEl.style.display = "block";
      console.error(e);
    }
  }

  function toggleMenu(open){
    drawer.style.display = open ? "flex" : "none";
    overlay.style.display = open ? "block" : "none";
    if(open) {
      if(menuTree.length === 0) loadData();
      else renderRootMenu();
    }
  }

  document.getElementById("openBtn").onclick = () => toggleMenu(true);
  document.getElementById("closeBtn").onclick = () => toggleMenu(false);
  overlay.onclick = () => toggleMenu(false);
</script>
</body>
</html>
